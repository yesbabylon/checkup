"use strict";var project=angular.module("project",["ngRoute","ngSanitize","ngCookies","ngAnimate","ngFileUpload","ui.bootstrap","ui.tinymce","oi.select","pascalprecht.translate","angularMoment","ngToast","ngHello"]).config(["ngToastProvider",function(e){e.configure({animation:"fade"})}]).config(function(){moment.updateLocale(global_config.locale,{calendar:{sameElse:"LLL"}})}).config(["$translateProvider",function(e){"undefined"!=typeof translations&&(console.log("translations loaded"),e.translations(global_config.locale,translations).preferredLanguage(global_config.locale).useSanitizeValueStrategy(["sanitizeParameters"]))}]).config(["$httpProvider","$httpParamSerializerJQLikeProvider",function(e,t){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",e.defaults.paramSerializer="$httpParamSerializerJQLike",e.defaults.transformRequest.unshift(t.$get())}]).config(["$locationProvider",function(e){e.html5Mode({enabled:!0,requireBase:!0,rewriteLinks:!0}).hashPrefix("!")}]).config(["helloProvider",function(e){e.init({facebook:"",google:"",twitter:""},{scope:"basic, email",redirect_uri:"oauth2callback",oauth_proxy:"https://auth-server.herokuapp.com/proxy"})}]).factory("httpRequestInterceptor",["$cookies",function(t){return{request:function(e){return e.headers.Authorization="Bearer "+t.get("access_token"),e}}}]).config(["$httpProvider",function(e){e.interceptors.push("httpRequestInterceptor")}]).run(["$window","$timeout","$rootScope","$location","$cookies","$http","hello",function(e,t,r,o,n,i,l){console.log("run method invoked"),r.viewContentLoading=!0,angular.element(document).ready(function(){console.log("dom ready")}),r.$on("$locationChangeStart",function(e){r.viewContentLoading=!0}),r.$on("$viewContentLoaded",function(e){console.log("$viewContentLoaded received"),r.viewContentLoading=!1})}]).controller("rootController",["$rootScope","$scope","$location","$route","$http",function(e,t,r,o,n){console.log("root controller");var i=this;i.isNavCollapsed=!0,i.tinymceOptions={inline:!1,plugins:"wordcount charcount advlist autolink link image lists charmap fullscreen preview table paste code",skin:"lightgray",theme:"modern",content_css:"packages/resipedia/apps/assets/css/bootstrap.min.css",elementpath:!1,block_formats:"Paragraph=p;Heading 1=h3;Heading 2=h4;Heading 3=h5;",formats:{bold:{inline:"b"},italic:{inline:"i"},underline:{inline:"u"}},menu:{edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript | charmap | removeformat"}},menubar:!1,toolbar:"fullscreen code | undo redo | bold italic | headings formatselect | blockquote bullist numlist outdent indent | link image | table",toggle_fullscreen:!1,setup:function(e){e.on("init",function(){angular.element(e.editorContainer).addClass("form-control")}),e.on("focus",function(){angular.element(e.editorContainer).addClass("focused")}),e.on("blur",function(){angular.element(e.editorContainer).removeClass("focused")}),e.on("FullscreenStateChanged",function(){console.log("fs"),i.tinymceOptions.toggle_fullscreen=!i.tinymceOptions.toggle_fullscreen,i.tinymceOptions.toggle_fullscreen?angular.element(e.editorContainer).addClass("mt-2"):angular.element(e.editorContainer).removeClass("mt-2")})}}}]);angular.module("project").service("routeObjectProvider",["$http","$route","$q",function(r,o,n){return{provide:function(e){var t=n.defer();return t.resolve({}),void 0===o.current.params.id||0==o.current.params.id?t.promise:r.get("index.php?get="+e+"&id="+o.current.params.id).then(function(e){var t=e.data;return"object"!=typeof t.result?{}:t.result},function(e){return t.promise})}}}]).service("routeArticlesProvider",["$http","$rootScope","$httpParamSerializerJQLike",function(e,r,t){this.load=function(){return e.get("index.php?get=resilexi_article_list&"+t(r.search.criteria)+"&channel="+r.config.channel).then(function(e){var t=e.data;return"object"!=typeof t.result?(r.search.criteria.total=0,[]):(r.search.criteria.total=t.total,t.result)},function(e){return r.search.criteria.total=0,[]})}}]).service("routeArticleProvider",["routeObjectProvider","$sce",function(e,n){this.load=function(){return e.provide("resilexi_article").then(function(r){var o={commentsLimit:5,newCommentShow:!1,newCommentContent:""};return angular.isDefined(r.articles)?angular.forEach(r.articles,function(e,t){r.articles[t].content=n.trustAsHtml(r.articles[t].content),angular.extend(r.articles[t],o)}):(angular.extend(r,o),r.content=n.trustAsHtml(r.content)),r})}}]),angular.module("project").controller("homeController",["$http","$scope","$rootScope","$location","$interval","$q","$uibModal","ngToast","$timeout",function(o,l,a,e,r,n,t,i,c){console.log("home controller");var s=this;s.errors={url:!1,server:!1},a.report_id=null,a.report_ready=!1,s.show_result_pane=!1,s.URL="",s.resetErrors=function(){s.errors.url=!1,s.errors.server=!1},l.results={PER:{score:0,tests:0,color:"blue",percent:100},SEC:{score:0,tests:0,color:"blue",percent:100},INT:{score:0,tests:0,color:"blue",percent:100},ADA:{score:0,tests:0,color:"blue",percent:100},LEG:{score:0,tests:0,color:"blue",percent:100},VIS:{score:0,tests:0,color:"blue",percent:100}},l.keydown=function(e){13==e.keyCode&&(e.srcElement.blur(),l.run())},a.scrolldown=function(){document.getElementById("footer").scrollIntoView(!1),angular.element(document.getElementById("section-scroll")).css("display","none")},l.run=function(){console.log("try to run checkup");var e=s.URL;if(-1==e.indexOf("http://")&&-1==e.indexOf("https://")&&(e="http://"+e),!function(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}(e))return console.log("invalid URL:"+e),document.getElementsByName("inputURL").forEach(function(e){e.setCustomValidity("URL ou domaine invalide")}),s.errors.url=!0,void l.formURL[0].reportValidity();document.getElementsByName("inputURL").forEach(function(e){e.setCustomValidity("")}),s.URL=e,a.report_ready=!1,angular.forEach(l.results,function(e,t){l.results[t].loading=!0}),o({method:"GET",url:"/index.php?get=checkup_report-id&url="+s.URL}).then(function(e){s.show_result_pane=!0;var t=e.data;a.report_id=t.report_id,n.all([o.get("/index.php?do=checkup_performance&report_id="+a.report_id),o.get("/index.php?do=checkup_security&report_id="+a.report_id),o.get("/index.php?do=checkup_adaptability&report_id="+a.report_id),o.get("/index.php?do=checkup_legality&report_id="+a.report_id),o.get("/index.php?do=checkup_integrability&report_id="+a.report_id),o.get("/index.php?do=checkup_visibility&report_id="+a.report_id)]).then(function(){r(function(){var i=6;angular.forEach(l.results,function(e,n){l.results[n].loading&&o({method:"GET",url:"/index.php?get=checkup_result&report_id="+a.report_id+"&category="+n}).then(function(e){var t=e.data,r=0,o=0;angular.forEach(t,function(e,t){e.pass&&++r,++o}),l.results[n].score=r,l.results[n].tests=o,l.results[n].percent=Math.floor(r/o*100),l.results[n].color="green",l.results[n].percent<=66&&(l.results[n].color="orange",l.results[n].percent<=33&&(l.results[n].color="red")),l.results[n].loading=!1,angular.element(document.getElementById("section-loader-"+n)).css("display","none"),--i||(console.log("report ready"),a.report_ready=!0)},function(){l.results[n].loading=!1,angular.element(document.getElementById("section-loader-"+n)).css("display","none")})})},2e3)})},function(e){s.errors.server=!0})},l.popup=function(){var r=t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"emailModal.html",controllerAs:"ctrl",controller:function(t,e){t.errors=[],t.result="",t.running=!1,this.send=function(){t.running=!0,t.errors=[],t.form_login.email.$valid||t.errors.push("La syntaxe de l'adresse email entrée n'est pas reconnue."),t.form_login.optin.$valid||t.errors.push("Veuillez valider l'accord d'utilisation de données personnelles."),t.errors.length?t.running=!1:o({method:"GET",url:"/index.php?do=checkup_send-report",params:{report_id:e.report_id,email:t.email}}).then(function(e){console.log(e),i.success({content:"<b>Rapport envoyé</b>: consultez votre boite email!",dismissButton:!0}),c(function(){t.running=!1,r.close()},100)},function(e){console.log(e),t.result="Vérifiez l'adresse email",i.danger({content:"<b>Erreur</b>: impossible d'envoyer le rapport",dismissButton:!0}),c(function(){t.result="",t.running=!1,r.close()},1e3)})}},size:"sm",appendTo:angular.element(document.querySelector(".modal-wrapper"))})}}]),angular.module("project").config(["$routeProvider","$routeParamsProvider","$httpProvider",function(o,e,t){var r="packages/checkup/apps/views/",n={"/article/edit/:id":"/article/edition/:id","/article/:id/:title?":"/article/:id/:title?","/articles":"/articles"},i={"/articles":{templateUrl:r+"articles.html",controller:"articlesController as ctrl",resolve:{articles:["routeArticlesProvider",function(e){return e.load()}]}},"/article/edit/:id":{templateUrl:r+"articleEdit.html",controller:"articleEditController as ctrl",resolve:{article:["routeArticleProvider",function(e){return e.load()}]}},"/article/:id/:title?":{templateUrl:r+"article.html",controller:"articleController as ctrl",resolve:{article:["routeArticleProvider",function(e){return e.load()}]}}};angular.forEach(i,function(e,t){var r=t;void 0!==n[t]?r=n[t]:console.warn("missing translation for route "+t),t!=r&&o.when(t,{redirectTo:r}),o.when(r,i[t])}),o.otherwise({templateUrl:r+"home.html",controller:"homeController as ctrl"})}]);